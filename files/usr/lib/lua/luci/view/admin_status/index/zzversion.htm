<%
local util = require "luci.util"
local fs = require "nixio.fs"

-- 读取并解析文件
local function parse_file(path)
    local data = {}
    local content = fs.readfile(path)
    if content then
        for line in content:gmatch("[^\r\n]+") do
            local key, value = line:match("^([%w_]+)='([^']*)'")
            if key and value then
                data[key] = value
            end
        end
    end
    return data
end

local build_info = parse_file("/etc/zz_build_id")
local release_info = parse_file("/etc/openwrt_release")
-%>

<style>
    #zzversion td {
        padding: 1.1em 1.25rem;
    }
</style>

<fieldset class="cbi-section">
    <h3>M28C 固件信息</h3>
    <table id="zzversion" width="100%">
        <tr>
            <td width="33%" style="vertical-align:top">
                <strong>版本</strong>
            </td>
            <td>
                <%= release_info.ZZ_DISTRIB_NAME or "ImmortalWrt for M28C" %> <%= release_info.ZZ_DISTRIB_VERSION or "Development Version" %><br/>
                <%= release_info.DISTRIB_DESCRIPTION %>
            </td>
        </tr>
        <tr>
            <td width="33%" style="vertical-align:top">
                <strong>构建信息</strong>
            </td>
            <td>
                构建 ID: <%= build_info.ZZ_BUILD_ID or "N/A" %><br/>
                构建日期: <%= build_info.ZZ_BUILD_DATE or "N/A" %><br/>
                构建主机: <%= build_info.ZZ_BUILD_HOST or "N/A" %><br/>
                构建用户: <%= build_info.ZZ_BUILD_USER or "N/A" %>
            </td>
        </tr>
        <tr>
            <td width="33%" style="vertical-align:top">
                <strong>仓库哈希</strong>
            </td>
            <td>
                构建程序仓库: <%= build_info.ZZ_BUILD_REPO_HASH or "N/A" %><br/>
                ImmortalWrt: <%= build_info.ZZ_BUILD_IMM_HASH or "N/A" %>
            </td>
        </tr>
    </table>
</fieldset>